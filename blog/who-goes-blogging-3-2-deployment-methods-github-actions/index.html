<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><script async defer data-domain=jdheyburn.co.uk src=https://stats.jdheyburn.co.uk/js/index.js></script><meta name=author content="Joseph D. Heyburn"><meta name=description content="Ramblings of a tech guy"><meta name=keywords content="blog,developer,devops,cloud"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jdheyburn.co.uk/github-actions-build.png"><meta name=twitter:title content="Who Goes Blogging 3.2: Deployment Methods - GitHub Actions"><meta name=twitter:description content="Migrating to GitHub Actions as our CI tool"><meta property="og:title" content="Who Goes Blogging 3.2: Deployment Methods - GitHub Actions"><meta property="og:description" content="Migrating to GitHub Actions as our CI tool"><meta property="og:type" content="article"><meta property="og:url" content="https://jdheyburn.co.uk/blog/who-goes-blogging-3-2-deployment-methods-github-actions/"><meta property="og:image" content="https://jdheyburn.co.uk/github-actions-build.png"><meta property="article:published_time" content="2020-03-10T00:00:00+00:00"><meta property="article:modified_time" content="2020-03-10T00:00:00+00:00"><base href=https://jdheyburn.co.uk/blog/who-goes-blogging-3-2-deployment-methods-github-actions/><title>Who Goes Blogging 3.2: Deployment Methods - GitHub Actions ¬∑ JDHeyburn</title><link rel=canonical href=https://jdheyburn.co.uk/blog/who-goes-blogging-3-2-deployment-methods-github-actions/><link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel=stylesheet><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.13.0/css/all.css integrity=sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=https://jdheyburn.co.uk/css/coder.min.a4f332213a21ce8eb521670c614470c58923aaaf385e2a73982c31dd7642decb.css integrity="sha256-pPMyITohzo61IWcMYURwxYkjqq84XipzmCwx3XZC3ss=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://jdheyburn.co.uk/css/coder-dark.min.83a2010dac9f59f943b3004cd6c4f230507ad036da635d3621401d42ec4e2835.css integrity="sha256-g6IBDayfWflDswBM1sTyMFB60DbaY102IUAdQuxOKDU=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://jdheyburn.co.uk/css/custom.css><link rel=icon type=image/png href=https://jdheyburn.co.uk/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://jdheyburn.co.uk/images/favicon-16x16.png sizes=16x16><meta name=generator content="Hugo 0.79.0"></head><body class=colorscheme-dark><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://jdheyburn.co.uk/>JDHeyburn</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fas fa-bars"></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://jdheyburn.co.uk/about/>About</a></li><li class=navigation-item><a class=navigation-link href=https://jdheyburn.co.uk/blog/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://jdheyburn.co.uk/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=https://jdheyburn.co.uk/contact/>Contact</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title>Who Goes Blogging 3.2: Deployment Methods - GitHub Actions</h1></div><div class=post-description><p>Migrating to GitHub Actions as our CI tool</p></div><div class=post-meta><div class=date><span class=posted-on><i class="fas fa-calendar"></i><time datetime=2020-03-10T00:00:00Z>10 March 2020</time></span>
<span class=reading-time><i class="fas fa-clock"></i>9-minute read</span></div><div class=tags><i class="fas fa-tag"></i><a href=https://jdheyburn.co.uk/tags/ci/cd/>ci/cd</a>
<span class=separator>‚Ä¢</span>
<a href=https://jdheyburn.co.uk/tags/travisci/>travisci</a>
<span class=separator>‚Ä¢</span>
<a href=https://jdheyburn.co.uk/tags/github-actions/>github-actions</a></div></div></header><div><aside><nav id=TableOfContents><ul><li><a href=#from-travisci-to-github-actions>From TravisCI to GitHub Actions</a><ul><li><a href=#benefits->Benefits ‚úÖ</a></li><li><a href=#pricing->Pricing ‚è∞</a></li></ul></li><li><a href=#creating-our-workflow>Creating Our Workflow</a><ul><li><a href=#deployment-keys-setup>Deployment Keys Setup</a></li><li><a href=#workflow-configuration>Workflow Configuration</a></li></ul></li><li><a href=#bringing-it-all-together-again>Bringing It All Together (Again)</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></aside><h2 id=from-travisci-to-github-actions>From TravisCI to GitHub Actions</h2><p>In the <a href=https://jdheyburn.co.uk/posts/who-goes-blogging-3-1-deployment-methods-travisci/>previous post</a> we looked at moving to a CI/CD model by moving from the <code>deploy.sh</code> script to TravisCI.</p><p>In this post we will look at how we can migrate from TravisCI to <a href=https://help.github.com/en/actions/getting-started-with-github-actions/about-github-actions>GitHub Actions</a>, GitHub&rsquo;s own CI/CD tool.</p><p>This post will also be useful if you are looking to onboard GitHub Actions as your CI/CD pipeline! üöÄ</p><h3 id=benefits->Benefits ‚úÖ</h3><p>Let&rsquo;s talk about why we want to migrate away from TravisCI in the first place.</p><p><strong>Firstly and most importantly</strong>, there is a whole community of shared actions (a set of build instructions) which can save you a <em>huge</em> amount of time when it comes to piecing together a CI pipeline. If the TravisCI config seemed a bit intimidating, then these will be a whole lot more gentler to you.</p><p>Whereas in our Travis config we had to define the individual commands needed to set up our environment and then how to build it, there&rsquo;s an <a href=https://github.com/marketplace/actions/hugo-setup>action</a> for that! Want to include some markdown linting? There&rsquo;s an <a href=https://github.com/marketplace/actions/markdownlint-cli>action</a> for that!</p><p>I think you folks get the picture now. There&rsquo;s an <a href=https://github.com/sdras/awesome-actions>awesome-actions</a> repository worth checking out for more actions.</p><p><strong>Secondly</strong>, all your DevOps tools are in one place! I&rsquo;m a big sucker for <a href=https://about.gitlab.com/>GitLab</a> and while I don&rsquo;t use it for my personal projects, I&rsquo;ve used it in a past life and found its seamless integration with all other tools second-to-none. Not having to worry about integrating between multiple services can only increase your productivity - allowing you to focus more on the application you&rsquo;re writing.</p><p><strong>Lastly</strong>, all configuration is managed in the workflow configuration file. One enhancement in particular that we will be introducing can be achieved with an additional setting in the workflow config file; for us to achieve the same in Travis would have to be done via the GUI. I&rsquo;m a big sucker for having configuration baked into code so this is a very good plus.</p><h3 id=pricing->Pricing ‚è∞</h3><p><strong>However</strong> - one downsides to GitHub Actions is how many build minutes you get. Remember Travis allowed unlimited build minutes for a public repository? With Actions - you are limited to <a href=https://github.com/pricing>2,000 minutes in their free plan</a>.</p><p>If you&rsquo;ve been building your project in Travis already, you&rsquo;ll notice it has been building (in my case at least) in ~30 seconds. With a bit of maths we can then say we will have 4,000 builds in a month on GitHub Actions.</p><p>Given that this isn&rsquo;t a huge project with multiple contributors working on it, I think it&rsquo;s safe to say we won&rsquo;t ever reach this limit - unless you&rsquo;re churning out blog posts left right and centre!</p><p>Sound good? Let&rsquo;s go.</p><h2 id=creating-our-workflow>Creating Our Workflow</h2><p>Like all great services in the world, there is <a href=https://help.github.com/en/actions>great documentation</a> to go along with them. Take a look over there if you&rsquo;d like the detailed version.</p><p>What I will be focusing on is the documentation for two sets of predefined actions; <a href=https://github.com/peaceiris/actions-hugo>actions-hugo</a> for building our website, and <a href=https://github.com/peaceiris/actions-gh-pages>actions-gh-pages</a> for deploying it to GitHub Pages.</p><h3 id=deployment-keys-setup>Deployment Keys Setup</h3><p>The very first thing we need to do is set up some keys that will allow our source repository (where the workflow will reside on) to push the built project to the GitHub Pages repo.</p><p>In your terminal, create those keys now and copy the contents of the public key to your clipboard.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ssh-keygen -t rsa -b <span style=color:#bd93f9>4096</span> -C <span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>$(</span>git config user.email<span style=color:#ff79c6>)</span><span style=color:#f1fa8c>&#34;</span> -f ~/.ssh/gh-pages -N <span style=color:#f1fa8c>&#34;&#34;</span>
Generating public/private rsa key pair.
Your identification has been saved in /home/jdheyburn/.ssh/gh-pages.
Your public key has been saved in /home/jdheyburn/.ssh/gh-pages.pub
<span style=color:#6272a4># ...</span>

$ pbcopy &lt; ~/.ssh/gh-pages.pub
</code></pre></div><blockquote><p>macOS has a handy terminal command to copy file contents to the clipboard called <code>pbcopy</code>. I&rsquo;ve created an alias on my Linux laptop that does the same.</p><p><code>alias pbcopy="xclip -selection clipboard"</code></p></blockquote><p>In GitHub load up your GitHub Pages repo and navigate to <code>Settings</code> and then <code>Deploy keys</code>. Give it an appropriate name, and paste in the public key. Make sure you check <code>Allow write access</code>.</p><figure><a href=gha-deploy-key.png><img src=gha-deploy-key.png alt="GitHub Pages repo deploy keys page"></a></figure><p>Copy the contents of the <em>private key</em> you created earlier (perhaps using your new command?! üòè) and navigate to the source code repository&rsquo;s <code>Settings</code> page, then <code>Secrets</code>. You&rsquo;ll need to give it a sensible name as this then referred to later in the workflow configuration. Paste the private key in the value field.</p><figure><a href=gha-secrets-key.png><img src=gha-secrets-key.png alt="GitHub source code repo secrets page"></a><figcaption><p>No secrets here!</p></figcaption></figure><h3 id=workflow-configuration>Workflow Configuration</h3><p>In the root directory of your source code repo, create a directory called <code>.github/workflows</code>. In this directory is where GitHub Actions will look for jobs to do. Create a <code>yml</code> file in this directory to contain your build job definition. I went ahead and named mine <code>deploy.yml</code>, but you can name it whatever you like.</p><p>I used the <a href=https://github.com/peaceiris/actions-gh-pages#%EF%B8%8F-repository-type---project>example</a> provided in the <code>actions-gh-pages</code> documentation as a base for my build definition.</p><script type=application/javascript src=https://gist.github.com/jdheyburn/b4b2cad15604de30f21ad0e1a85ee6b9.js></script><p>This config is much simpler to understand than the Travis one - let&rsquo;s break it down once more.</p><h4 id=build-metadata-and-environment>Build Metadata and Environment</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#ff79c6>name</span>: Build and deploy to jdheyburn.github.io

<span style=color:#ff79c6>on</span>:
  <span style=color:#ff79c6>push</span>:
    <span style=color:#ff79c6>branches</span>:
      - master
  <span style=color:#ff79c6>schedule</span>:
    - <span style=color:#ff79c6>cron</span>:  <span style=color:#f1fa8c>&#34;0 10 * * *&#34;</span>

<span style=color:#ff79c6>jobs</span>:
  <span style=color:#ff79c6>deploy</span>:
    <span style=color:#ff79c6>runs-on</span>: ubuntu-18.04
</code></pre></div><p>This is pretty box standard at this point. We&rsquo;re simply giving the name to the workflow and saying to run it on every push to the <code>master</code> branch.</p><p>An enhancement that we&rsquo;re adding is the <code>on.schedule.cron</code> setting. This tells Actions not only to build the project on every push to the <code>master</code> branch but on a timed schedule too - in my example this is at 10am everyday. We could have done the same via Travis, but that can only be <a href=https://docs.travis-ci.com/user/cron-jobs/>configured via the GUI</a>.</p><blockquote><p>The benefit to this is the way in which Hugo generates content. Hugo will only build content pages where the date on the content is either today or in the past, and is not a draft.</p><p>Therefore if you had written a post due to be published in the future, you can define that date and have the daily Hugo build publish it when that date has been reached - which is exactly how this blog post was published!</p></blockquote><p><code>jobs</code> is the field that contains the work we want to run. We&rsquo;re giving the job a name of <code>deploy</code> and telling it to run on <code>ubuntu-18.04</code> - which is the equivalent to <code>bionic</code> in Ubuntu.</p><blockquote><p>In order to keep our build the same as Travis&rsquo;s, we could instruct the job to run on <code>ubuntu-16.04</code>, nonetheless I&rsquo;m pretty confident it will run on the next <a href=https://wiki.ubuntu.com/Releases>LTS of Ubuntu</a>.</p></blockquote><h4 id=project-checkout>Project Checkout</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#6272a4># ...</span>
<span style=color:#ff79c6>steps</span>:
  - <span style=color:#ff79c6>uses</span>: actions/checkout@v2

  - <span style=color:#ff79c6>name</span>: Checkout submodules
    <span style=color:#ff79c6>shell</span>: bash
    <span style=color:#ff79c6>run</span>: |<span style=color:#f1fa8c>
</span><span style=color:#f1fa8c>      auth_header=&#34;$(git config --local --get http.https://github.com/.extraheader)&#34;
</span><span style=color:#f1fa8c>      git submodule sync --recursive
</span><span style=color:#f1fa8c>      git -c &#34;http.extraheader=$auth_header&#34; -c protocol.version=2 submodule update --init --force --recursive --depth=1</span>      
</code></pre></div><p>Here we&rsquo;re executing the GitHub <a href=https://github.com/actions/checkout>checkout action</a> which will pull the repo to the build server. It&rsquo;s worth noting that this action version I&rsquo;m using here doesn&rsquo;t checkout git submodules too - which is a problem for us as that&rsquo;s how we&rsquo;re currently pulling the theme for our Hugo site. We can workaround it with the next step in the build - <code>Checkout submodules</code>.</p><p>This functionality was available in v1 of the action, so you can use that if you&rsquo;d prefer:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#ff79c6>steps</span>:
  - <span style=color:#ff79c6>uses</span>: actions/checkout@v2
    <span style=color:#ff79c6>with</span>: 
      <span style=color:#ff79c6>submodules</span>: <span style=color:#ff79c6>true</span>
</code></pre></div><blockquote><p>It&rsquo;s worth noting that we didn&rsquo;t have to do this step for Travis - since it will checkout the repository with submodules already.</p><p>This is because GitHub Actions can be used for many more things than just repository code manipulation where you may not necessarily need the repo checked out.</p></blockquote><h4 id=build-and-deploy-setup>Build and Deploy Setup</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml>- <span style=color:#ff79c6>name</span>: Setup Hugo
  <span style=color:#ff79c6>uses</span>: peaceiris/actions-hugo@v2
  <span style=color:#ff79c6>with</span>:
    <span style=color:#ff79c6>hugo-version</span>: <span style=color:#f1fa8c>&#34;0.58.3&#34;</span>
    <span style=color:#ff79c6>extended</span>: <span style=color:#ff79c6>true</span>
</code></pre></div><p>As stated we&rsquo;re going to be using the Action <a href=https://github.com/peaceiris/actions-hugo>actions-hugo</a> to set up <code>hugo</code> on our build server. It can take in a number of parameters to allow us to customise it; for us we&rsquo;re only concerned with hardcoding the version of Hugo, and to use the Hugo Extended binary as required by our theme.</p><blockquote><p>At the time of writing 0.58.3 is not the latest version of Hugo, whereas when I wrote <code>.travis.yml</code> it was. I want the GitHub Actions build to be as close as possible to the TravisCI build in order to make them as similar as possible to prevent any unexpected build errors.</p><p>Once I&rsquo;ve achieved a successful build - I&rsquo;ll look to upgrade to a newer version, and then iron out any issues from there.</p></blockquote><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml>- <span style=color:#ff79c6>name</span>: Build
  <span style=color:#ff79c6>run</span>: hugo --gc --minify
</code></pre></div><p>Once <code>hugo</code> is set up we can then build it easily enough, as self-documented in the code.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml>- <span style=color:#ff79c6>name</span>: Copy CNAME
  <span style=color:#ff79c6>run</span>: cp CNAME ./public/
</code></pre></div><p>Lastly, we can&rsquo;t forget to copy the <code>CNAME</code> file we made in <a href=https://jdheyburn.co.uk/posts/who-goes-blogging-2-custom-domain/#solidying-our-changes-with-a-cname-file>part 2</a>.</p><h4 id=deployment-to-github-pages>Deployment to GitHub Pages</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml>- <span style=color:#ff79c6>name</span>: Deploy
  <span style=color:#ff79c6>uses</span>: peaceiris/actions-gh-pages@v3
  <span style=color:#ff79c6>with</span>:
    <span style=color:#ff79c6>deploy_key</span>: ${{ secrets.DEPLOY_KEY }}
    <span style=color:#ff79c6>external_repository</span>: jdheyburn/jdheyburn.github.io
    <span style=color:#ff79c6>publish_branch</span>: master
    <span style=color:#ff79c6>publish_dir</span>: ./public
    <span style=color:#ff79c6>commit_message</span>: ${{ github.event.head_commit.message }}
</code></pre></div><p>For the deployment to GitHub Pages I&rsquo;m using the action <a href=https://github.com/peaceiris/actions-gh-pages>actions-gh-pages</a>. Again it only requires a bare minimum of parameters to work; an explanation of what I&rsquo;m using is:</p><ul><li><code>deploy_key</code> is the <em>private key</em> we set up <a href=#deployment-keys-setup>earlier in this post</a> in <code>Settings</code> -> <code>Secrets</code><ul><li>If you didn&rsquo;t name yours <code>DEPLOY_KEY</code> then you&rsquo;ll need to change it here too.</li></ul></li><li><code>external_repository</code> tells the action where we want the built website to go to - we set this to our GitHub Pages repo</li><li><code>publish_branch</code> is the branch of the repo we publish to</li><li><code>publish_dir</code> is the directory on the build server that we want to push to the repo<ul><li>Remember that <code>hugo</code> builds the website to the <code>public</code> directory locally</li></ul></li><li><code>commit_message</code> allows us to specify a custom commit message to the target repo<ul><li>Here I am telling it to inherit the commit message used in the source repo</li></ul></li></ul><h2 id=bringing-it-all-together-again>Bringing It All Together (Again)</h2><p>If you&rsquo;re migrating from a previous CI tool (perhaps Travis?) then you&rsquo;ll need to disable the builds on there since you may cause a conflict either build process.</p><p>For Travis, you can do that by navigating to your source code repo settings on Travis (<a href=https://travis-ci.com/jdheyburn/jdheyburn.co.uk/settings>https://travis-ci.com/jdheyburn/jdheyburn.co.uk/settings</a> for me) and disabling <code>Build pushed branches</code>.</p><figure class=center><a href=travis-disable-build.png><img src=travis-disable-build.png alt="Build pushed branches disabled on Travis"></a></figure><p>Now that&rsquo;s done, go ahead and check in your new GitHub Actions workflow file and then navigate to the <code>Actions</code> tab of your source code repo on GitHub.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git add --all
git commit -m <span style=color:#f1fa8c>&#39;Migrate to GitHub Actions&#39;</span>
git push
</code></pre></div><figure><a href=github-actions-build.png><img src=github-actions-build.png alt="Successful build on GitHub Actions"></a><figcaption><p>Great success!</p></figcaption></figure><p>Hopefully your build went to success! If it didn&rsquo;t have a look through the logs and see what the issue was. It took me a few builds to determine my finalised workflow config. You can even see it at my <a href=https://github.com/jdheyburn/jdheyburn.co.uk/actions>source code repo Actions page</a>.</p><h2 id=conclusion>Conclusion</h2><p>Now that we&rsquo;ve migrated across over to GitHub Actions, we can close out the permissions that TravisCI has on our projects, and demise any secret keys we gave it.</p><p>From the tone of my writing you can probably tell which one I favour. That&rsquo;s not to say I do not like TravisCI - each service has its own pros and cons. For this particular project, I prefer the one platform approach for which I am used to in GitLab. The number of build minutes available for GA is a concern, but not one I will have to worry about for now.</p><p>Thanks for reading! üåù</p></div><footer><section class=see-also><h3>See also in Who Goes Blogging</h3><nav><ul><li><a href=https://jdheyburn.co.uk/blog/who-goes-blogging-6-three-steps-to-improve-hugos-rss-feeds/>Who Goes Blogging 6: Three Steps to Improve Hugo's RSS Feeds</a></li><li><a href=https://jdheyburn.co.uk/blog/who-goes-blogging-5-updates-galore/>Who Goes Blogging 5: Updates Galore!</a></li><li><a href=https://jdheyburn.co.uk/blog/who-goes-blogging-4-content-structure-and-refactoring/>Who Goes Blogging 4: Content Structure & Refactoring</a></li><li><a href=https://jdheyburn.co.uk/blog/who-goes-blogging-3-1-deployment-methods-travisci/>Who Goes Blogging 3.1: Deployment Methods - TravisCI</a></li><li><a href=https://jdheyburn.co.uk/blog/who-goes-blogging-2-custom-domain/>Who Goes Blogging 2: Custom Domain</a></li></ul></nav></section></footer></article></section></div><footer class=footer><section class=container>¬©
2020
Joseph D. Heyburn
¬∑
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main></body></html>