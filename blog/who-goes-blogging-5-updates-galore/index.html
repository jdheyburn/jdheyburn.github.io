<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script async defer data-domain="jdheyburn.co.uk" src="https://stats.jdheyburn.co.uk/js/index.js"></script>
    
    <meta name="author" content="Joseph D. Heyburn">
    <meta name="description" content="Ramblings of a tech guy">
    <meta name="keywords" content="blog,developer,devops,cloud">

    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://jdheyburn.co.uk/images/jdheyburn_co_uk_card.png"/>

<meta name="twitter:title" content="Who Goes Blogging 5: Updates Galore!"/>
<meta name="twitter:description" content="I update the theme, hugo version, fix bugs, and add some new functionality to the website"/>

    <meta property="og:title" content="Who Goes Blogging 5: Updates Galore!" />
<meta property="og:description" content="I update the theme, hugo version, fix bugs, and add some new functionality to the website" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jdheyburn.co.uk/blog/who-goes-blogging-5-updates-galore/" />
<meta property="og:image" content="https://jdheyburn.co.uk/images/jdheyburn_co_uk_card.png"/>
<meta property="article:published_time" content="2020-04-19T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-04-19T00:00:00+00:00" />



    
      <base href="https://jdheyburn.co.uk/blog/who-goes-blogging-5-updates-galore/">
    
    <title>
  Who Goes Blogging 5: Updates Galore! ¬∑ JDHeyburn
</title>

    
      <link rel="canonical" href="https://jdheyburn.co.uk/blog/who-goes-blogging-5-updates-galore/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css" integrity="sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://jdheyburn.co.uk/css/coder.min.a4f332213a21ce8eb521670c614470c58923aaaf385e2a73982c31dd7642decb.css" integrity="sha256-pPMyITohzo61IWcMYURwxYkjqq84XipzmCwx3XZC3ss=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="https://jdheyburn.co.uk/css/coder-dark.min.83a2010dac9f59f943b3004cd6c4f230507ad036da635d3621401d42ec4e2835.css" integrity="sha256-g6IBDayfWflDswBM1sTyMFB60DbaY102IUAdQuxOKDU=" crossorigin="anonymous" media="screen" />
      
    

    
      <link rel="stylesheet" href="https://jdheyburn.co.uk/css/custom.css" />
    

    

    

    <link rel="icon" type="image/png" href="https://jdheyburn.co.uk/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://jdheyburn.co.uk/images/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.79.0" />
  </head>

  
  
    
  
  <body class="colorscheme-dark">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://jdheyburn.co.uk/">
      JDHeyburn
    </a>
    
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://jdheyburn.co.uk/about/">About</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://jdheyburn.co.uk/blog/">Blog</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://jdheyburn.co.uk/projects/">Projects</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://jdheyburn.co.uk/contact/">Contact</a>
          </li>
        
      
      
    </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      
      
      
      <header>
        

        <div class="post-title">
          <h1 class="title">Who Goes Blogging 5: Updates Galore!</h1>
        </div>
        <div class="post-description">
          <p>I update the theme, hugo version, fix bugs, and add some new functionality to the website</p>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2020-04-19T00:00:00Z'>
                19 April 2020
              </time>
            </span>
            
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              14-minute read
            </span>
          </div>
          
          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://jdheyburn.co.uk/tags/emojis/">emojis</a>
      <span class="separator">‚Ä¢</span>
    <a href="https://jdheyburn.co.uk/tags/toc/">toc</a>
      <span class="separator">‚Ä¢</span>
    <a href="https://jdheyburn.co.uk/tags/hugo/">hugo</a></div>

        </div>
      </header>

      <div>
        
<aside>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#upgrading-hugo">Upgrading Hugo</a>
      <ul>
        <li><a href="#testing-for-any-issues">Testing For Any Issues</a></li>
        <li><a href="#updating-hugo-in-cicd">Updating Hugo in CI/CD</a></li>
      </ul>
    </li>
    <li><a href="#upgrading-hugo-theme">Upgrading Hugo Theme</a>
      <ul>
        <li><a href="#a-git-submodules-recap">A git submodules recap</a></li>
        <li><a href="#upgrading-submodules">Upgrading Submodules</a></li>
      </ul>
    </li>
    <li><a href="#validation-and-testing">Validation and Testing</a>
      <ul>
        <li><a href="#center-tags-not-rending-correctly"><code>&lt;center&gt;</code> tags not rending correctly</a></li>
        <li><a href="#lists-not-rendering-as-before">Lists not rendering as before</a></li>
      </ul>
    </li>
    <li><a href="#adding-new-features">Adding New Features</a></li>
    <li><a href="#adding-series-links-in-content-footer">Adding Series Links in Content Footer</a></li>
    <li><a href="#adding-table-of-contents">Adding Table of Contents</a>
      <ul>
        <li><a href="#template-lookup-order-primer">Template Lookup Order Primer</a></li>
        <li><a href="#implementation">Implementation</a></li>
        <li><a href="#bugs-along-the-way">Bugs Along The Way</a></li>
      </ul>
    </li>
    <li><a href="#emojify-everything">Emojify Everything!</a>
      <ul>
        <li><a href="#fix-post--browser-title">Fix Post &amp; Browser Title</a></li>
        <li><a href="#fix-type-list-entry">Fix Type List Entry</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
</aside>

        <p>In this article we&rsquo;re going to continue making some improvements to our Hugo website. Some of the things going to be covered are:</p>
<ol>
<li>Upgrading our Hugo theme</li>
<li>Upgrading the Hugo version</li>
<li>Adding table of contents</li>
<li>Adding support for title emojis</li>
</ol>
<p>So far since this website has launched we haven&rsquo;t upgraded either the Hugo version used to build our website, alongside the theme being used. Hugo is a very active project with new features and bug fixes being added all the time. By not upgrading Hugo, we are missing out on enhancements that we can make to the site.</p>
<p>As for upgrading the theme, improvements in the styling or even making use of said new features in Hugo can be added as part of the theme. Remember that when you execute a <code>hugo</code> command, turning the website from markdown to rendered HTML files, that the theme chosen will be used to render those files.</p>
<h2 id="upgrading-hugo">Upgrading Hugo</h2>
<p>This varies depending on what OS you are running on, but it is pretty much identical as the steps taken to install Hugo in the <a href="https://jdheyburn.co.uk/blog/who-goes-blogging-1-getting-started/#blog-bootstrapping">first place</a>. Even the <a href="https://gohugo.io/getting-started/installing/#upgrade-hugo">documentation for upgrading</a> is a one-liner:</p>
<blockquote>
<p>Upgrading Hugo is as easy as downloading and replacing the executable you‚Äôve placed in your <code>PATH</code>, or running <code>brew upgrade hugo</code> if using Homebrew on macOS.</p>
</blockquote>
<p>A quick execute of <code>hugo version</code> tells us what we&rsquo;re currently running. We can then have a look at the <a href="https://github.com/gohugoio/hugo/releases/">Hugo release page</a> to find the latest one - which at the time of writing is <a href="https://github.com/gohugoio/hugo/releases/tag/v0.68.3">0.68.3</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ hugo version
Hugo Static Site Generator v0.58.3-4AAC02D4/extended linux/amd64 BuildDate: 2019-09-19T15:34:54Z
</code></pre></div><p>I run Linux so I would need to replace the executable on my <code>PATH</code>. This can be done with a handy script to pull the archive and install it for us.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8be9fd;font-style:italic">HUGO_VERSION</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.68.3&#34;</span>
wget <span style="color:#f1fa8c">&#34;https://github.com/gohugoio/hugo/releases/download/v</span><span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">HUGO_VERSION</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">/hugo_extended_</span><span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">HUGO_VERSION</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">_Linux-64bit.tar.gz&#34;</span>
tar -zxvf <span style="color:#f1fa8c">&#34;hugo_extended_</span><span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">HUGO_VERSION</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">_Linux-64bit.tar.gz&#34;</span> hugo
sudo mv -v hugo /usr/local/bin
hugo version
rm <span style="color:#f1fa8c">&#34;hugo_extended_</span><span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">HUGO_VERSION</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">_Linux-64bit.tar.gz&#34;</span>
</code></pre></div><p>Remember that the hugo-coder theme requires the extended version of Hugo in order for it to render files correctly.</p>
<blockquote>
<p>You can see where <code>hugo</code> is currently installed on your system with the command <code>which hugo</code>, given it is in your <code>PATH</code>.</p>
</blockquote>
<p>Executing <code>hugo version</code> one more time confirms if the upgrade took place.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ hugo version
Hugo Static Site Generator v0.68.3-157669A0/extended linux/amd64 BuildDate: 2020-03-24T12:13:38Z
</code></pre></div><h3 id="testing-for-any-issues">Testing For Any Issues</h3>
<p>At this point I would advise you do some testing with the new version to determine if your site is not only rendering as expected but functioning too. You can do this with the good old <code>hugo serve</code> command as you would have used before when writing out articles, and fixing anything that looks out of place.</p>
<p>However, since I&rsquo;m going to be upgrading the hugo theme too, I&rsquo;ll do my testing in one hit <a href="#validation-and-testing">later in this post</a>.</p>
<h3 id="updating-hugo-in-cicd">Updating Hugo in CI/CD</h3>
<p>We&rsquo;ve only upgrading Hugo on our machines, but we also need to upgrade it in our CI/CD pipeline to ensure it deploys with the correct rendering too. We set this up in parts <a href="https://jdheyburn.co.uk/blog/who-goes-blogging-3-1-deployment-methods-travisci/">3.1</a> and <a href="https://jdheyburn.co.uk/blog/who-goes-blogging-3-2-deployment-methods-github-actions/">3.2</a>.</p>
<p>I&rsquo;m using GitHub Actions for my CI/CD pipeline, so I need to head to <code>.github/workflows/deploy.yml</code> and change <code>hugo-version: &quot;0.58.3&quot;</code> to <code>hugo-version: &quot;0.68.3&quot;</code>.</p>
<p>It&rsquo;s as easy as that thanks to the pre-made GitHub Action!</p>
<h2 id="upgrading-hugo-theme">Upgrading Hugo Theme</h2>
<h3 id="a-git-submodules-recap">A git submodules recap</h3>
<p>As mentioned before, I&rsquo;m using hugo-coder as the theme for my Hugo website which is being pulled as a submodule in my git repository. I can interface with it via the command <code>git submodules</code>.</p>
<p>One of the cool things about <code>git submodules</code> is I don&rsquo;t need to have a copy of the source code for the theme in my project. I can just reference the codebase at a particular point in time - or a commit, and git will pull in the resources for which then my Hugo website can utilise it.</p>
<p>We already defined this back in the <a href="https://jdheyburn.co.uk/blog/who-goes-blogging-1-getting-started/">first post of this series</a>, in our root directory we created a file called <code>.gitmodules</code> with the following contents:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">[</span>submodule <span style="color:#f1fa8c">&#34;themes/hugo-coder&#34;</span><span style="color:#ff79c6">]</span>
	<span style="color:#8be9fd;font-style:italic">path</span> <span style="color:#ff79c6">=</span> themes/hugo-coder
	<span style="color:#8be9fd;font-style:italic">url</span> <span style="color:#ff79c6">=</span> https://github.com/luizdepra/hugo-coder.git
</code></pre></div><p>Line by line, we are giving the submodule a name, telling git where to check out the module to, and lastly where git can find the repository for the module when we checkout our project.</p>
<p>When we pull in the submodule for the first time, it creates a tree in our projects <code>.git/modules</code> filled with metadata about the submodule.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ tree .git/modules/themes/hugo-coder -L <span style="color:#bd93f9">1</span>
.git/modules/themes/hugo-coder
‚îú‚îÄ‚îÄ branches
‚îú‚îÄ‚îÄ config
‚îú‚îÄ‚îÄ description
‚îú‚îÄ‚îÄ HEAD
‚îú‚îÄ‚îÄ hooks
‚îú‚îÄ‚îÄ index
‚îú‚îÄ‚îÄ info
‚îú‚îÄ‚îÄ logs
‚îú‚îÄ‚îÄ objects
‚îú‚îÄ‚îÄ packed-refs
‚îî‚îÄ‚îÄ refs
</code></pre></div><blockquote>
<p>The <code>.git/</code> directory contains all the metadata about your repository so that <code>git</code> knows where to pull/push to/from the repository, <a href="https://githowto.com/git_internals_git_directory">amongst other things</a>. It has a near identical directory structure to the one shown above.</p>
</blockquote>
<p>One of the files in this directory is called <code>HEAD</code>, and it contains the commit of which <code>git</code> should checkout the submodule</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat .git/modules/themes/hugo-coder/HEAD
e66c1740611b15eee0069811d10b5a22b0dc4332
</code></pre></div><p>We can even view this commit in the repository at <a href="https://github.com/luizdepra/hugo-coder/commit/e66c1740611b15eee0069811d10b5a22b0dc4332">https://github.com/luizdepra/hugo-coder/commit/e66c1740611b15eee0069811d10b5a22b0dc4332</a>.</p>
<h3 id="upgrading-submodules">Upgrading Submodules</h3>
<p>To upgrade submodules in your project, you simply need to execute the command below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git submodule update --recursive --remote
</code></pre></div><p>We can then check the value in <code>.git/modules/themes/hugo-coder/HEAD</code> and see what this is updated to.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat .git/modules/themes/hugo-coder/HEAD
acb4bf6f2dcce51a27dc0e1f1008afb369d378d8
</code></pre></div><p>Nice - this has changed from the previous value. We can jump over to GitHub to verify this is indeed the latest version.</p>
<figure><a href="hugo-coder-commit.png">
    <img src="hugo-coder-commit.png"
         alt="Screenshot showing latest hugo-coder version in GitHub"/> </a><figcaption>
            <p>Verify at the <a href="https://github.com/luizdepra/hugo-coder/commit/master">GitHub repo page</a></p>
        </figcaption>
</figure>

<h2 id="validation-and-testing">Validation and Testing</h2>
<p>Now comes the testing part, ensuring that everything is working as intended with both the new Hugo version and the latest hugo-coder submodule. Some of the issues I came across were:</p>
<h3 id="center-tags-not-rending-correctly"><code>&lt;center&gt;</code> tags not rending correctly</h3>
<p>I believe the new Hugo version broke this one, where images that were wrapped in <code>&lt;center&gt;</code> tags were simply disappearing. I had been wrapping <code>{{&lt; figure ... &gt;}}</code> shortcodes in <code>&lt;center&gt;</code> tags in order to horizontally centre images - but it looks like the new version causes these images to appear completely.</p>
<p>It looks like the <code>figure</code> shortcodes now support <code>center</code> as a <code>class</code> property. Therefore we go from&hellip;</p>
<p><code>&lt;center&gt;{{&lt; figure src=&quot;image-name.png&quot; &gt;}}&lt;/center&gt;</code></p>
<p>To&hellip;</p>
<p><code>{{&lt; figure src=&quot;image-name.png&quot; class=&quot;center&quot; &gt;}}</code></p>
<h3 id="lists-not-rendering-as-before">Lists not rendering as before</h3>
<p>It turns out that my markdown for articles wasn&rsquo;t as watertight as I thought; Hugo is now a whole lot more strict in ensuring your syntax is correct. Check these two before and after for comparison.</p>
<figure>
    <img src="old-render-list.png" class="screenshotimg"
         alt="Screenshot showing old, proper list render"/> 
</figure>

<figure>
    <img src="new-render-list.png" class="screenshotimg"
         alt="Screenshot showing new, incorrect list render"/> 
</figure>

<p>For this I just needed to fix the markdown by adding another indent to the list item.</p>
<figure><a href="git-diff-list.png">
    <img src="git-diff-list.png"
         alt="Screenshot showing git diff between old and new list"/> </a>
</figure>

<p>I saw several cases of this, and including a <a href="https://github.com/igorshubovych/markdownlint-cli">markdown linter</a> in the CI/CD pipeline would help to prevent this. This is something I&rsquo;ll look to include in the near future.</p>
<h2 id="adding-new-features">Adding New Features</h2>
<p>The whole reason to upgrade both Hugo and the theme was to explore some of the new features that come in both of them, so let&rsquo;s get adding them.</p>
<h2 id="adding-series-links-in-content-footer">Adding Series Links in Content Footer</h2>
<p>The hugo-coder theme now has better support for series - these are articles that directly follow on from one another, such as this Who Goes Blogging one. Series are nothing new to Hugo and we could have done them with the version we upgraded from, only in <a href="https://github.com/luizdepra/hugo-coder/commit/27e83b1e5a9d8b7bbd42d202bd5ef57adcce659b">this commit for hugo-coder</a> has it added a layout for it to be rendered.</p>
<p>To create a series, we use the <code>series</code> front matter setting for articles. For the Who Goes Blogging articles, adding the front matter to them looks like this.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">---
<span style="color:#ff79c6">date</span>: 2020-03-10
<span style="color:#ff79c6">title</span>: <span style="color:#f1fa8c">&#34;Who Goes Blogging 3.2: Deployment Methods - GitHub Actions&#34;</span>
<span style="color:#6272a4">#...</span>
<span style="display:block;width:100%;background-color:#3d3f4a"><span style="color:#ff79c6">series</span>:
</span><span style="display:block;width:100%;background-color:#3d3f4a">  - Who Goes Blogging
</span><span style="color:#ff79c6">tags</span>:
<span style="color:#6272a4">#...</span>
---

</code></pre></div><p>Once this is done for all pages, hugo-coder will render the <a href="#conclusion"><strong>See also in &hellip;</strong></a> section at the article footer.</p>
<figure>
    <img src="series-footer-section.png" class="screenshotimg"
         alt="Screenshot showing series rendered in the page footer"/> 
</figure>

<h2 id="adding-table-of-contents">Adding Table of Contents</h2>
<p>Okay this one isn&rsquo;t exactly a new feature of the theme, but since we&rsquo;re playing around we may as well make use of this opportunity. Table of contents (TOC) aren&rsquo;t included by default in the <code>hugo-coder</code> theme, so we need to add it in ourselves.</p>
<p>There is some <a href="https://gohugo.io/content-management/toc/">documentation</a> on how to add TOC to your articles. Before we do that we need to revisit how layouts are organised as discussed briefly in <a href="https://jdheyburn.co.uk/blog/who-goes-blogging-4-content-structure-and-refactoring/#fixing-article-rendering">a previous post</a>.</p>
<h3 id="template-lookup-order-primer">Template Lookup Order Primer</h3>
<p>The type of a markdown file (defined by the front matter setting <code>type</code>) tells Hugo where to look for in the <code>layouts/</code> directory of your project. The Hugo theme you&rsquo;re using will already have these all defined, hence why they are predefined themes! Before Hugo looks for these layout HTML files in your theme, it will check for them in your projects <code>layouts/</code> directory first.</p>
<p>In other words, the order of precedence (or hierarchy) for HTML files is anything in the project <code>layouts/</code> directory takes a higher priority than that in your theme - as described in Hugo&rsquo;s <a href="https://gohugo.io/templates/lookup-order/">documentation for template lookup order</a>.</p>
<p>See below for a directory tree explaning this - a lot of content has been removed for brevity.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ tree layouts
layouts
‚îú‚îÄ‚îÄ posts
‚îÇ   ‚îî‚îÄ‚îÄ single.html					<span style="color:#6272a4"># hugo will use this file to render your HTML</span>
‚îî‚îÄ‚îÄ themes
    ‚îî‚îÄ‚îÄ hugo-coder
	    ‚îî‚îÄ‚îÄ layouts
			‚îî‚îÄ‚îÄ posts
			    ‚îî‚îÄ‚îÄ single.html     <span style="color:#6272a4"># hugo will ignore this one in the themes directory</span>
</code></pre></div><h3 id="implementation">Implementation</h3>
<p>The primer above gives a hint as to what file we need to modify. The <a href="https://github.com/luizdepra/hugo-coder/blob/master/layouts/posts/single.html"><code>single.html</code></a> file is in charge of how articles are rendered. Since we want everything else to remain the same about this file, we can take a copy of the file as it currently stands and place it into our project root.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir layouts/posts
cp -v themes/hugo-coder/layouts/posts/single.html layouts/posts
</code></pre></div><blockquote>
<p>I won&rsquo;t go into the details here, I&rsquo;ll leave that to you to make changes to see how they affect the rendering of the page.</p>
</blockquote>
<p>I want the TOC to appear before the main content, but after the featured image for the article (if there is any). Based on this the files is going to need the highlighted change below.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="display:block;width:100%;background-color:#3d3f4a"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#ff79c6">div</span>&gt;
  {{ if .Params.featured_image }}
  &lt;<span style="color:#ff79c6">img</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;{{ .Params.featured_image }}&#34;</span> <span style="color:#50fa7b">alt</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Featured image&#34;</span> /&gt;
  {{ end }}
<span style="display:block;width:100%;background-color:#3d3f4a">  {{ partial &#34;toc.html&#34; . }}
</span>  {{ .Content }}
&lt;/<span style="color:#ff79c6">div</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>We&rsquo;re not done there - we&rsquo;ve referenced a <a href="https://gohugo.io/templates/partials/">partial template file</a> here. These allow us to reuse HTML files in multiple places, or to break up a large HTML file into smaller, more easier to manage chunks.</p>
<p>Partial templates are found under the <code>layouts/partials</code> directory and follow the same principle as defined in the primer for template lookups, and are referenced back as <code>{{ partial &quot;&lt;partial_name&gt;.html&quot; . }}</code>.</p>
<p>Let&rsquo;s go ahead and create the <code>layouts/partials/toc.html</code> file and populate it as below.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">{{ if and (gt .WordCount 400 ) (.Site.Params.toc) }}
&lt;<span style="color:#ff79c6">aside</span>&gt;
  {{.TableOfContents}}
&lt;/<span style="color:#ff79c6">aside</span>&gt;
{{ end }}
</code></pre></div><p>This is similar to <a href="https://gohugo.io/content-management/toc/#template-example-toc-partial">Hugo&rsquo;s example</a> but just tweaked a bit. I&rsquo;m not looking to do anything too fancy with the styling just yet, but maybe later on.</p>
<p>Previewing it by <code>hugo serve</code> we should get something that appears as below.</p>
<figure>
    <img src="completed-toc.png" class="screenshotimg"
         alt="Screenshot showing rendered Table of Contents"/> 
</figure>

<h3 id="bugs-along-the-way">Bugs Along The Way</h3>
<p>As the heading suggests, there were a few extra things I needed to change before releasing it into the wild.</p>
<h4 id="fix-improper-headings">Fix Improper Headings</h4>
<p>Per <a href="https://gohugo.io/content-management/toc/#usage">Table of Contents Usage documentation</a>, Hugo will render from <code>&lt;h2&gt;</code> headings, which are defined as <code>##</code> in markdown. So <code># Introduction</code> would not be included in the TOC, but <code>## Introduction</code> will.</p>
<p>This is a problem for some of my articles since I&rsquo;ve been writing headings liberally at the wrong level.</p>
<figure class="center">
    <img src="improper-toc-headings.png" class="screenshotimg"
         alt="Screenshot showing table of contents not including all headings for a post"/> <figcaption>
            <p>Notice the <strong>Applying Cartography</strong> heading doesn&rsquo;t appear in the TOC</p>
        </figcaption>
</figure>

<p>The given example above shows what happens when we use <code># Heading Name</code> instead of <code>## Heading Name</code>. To fix this I just need to go through each heading and make sure top-level headings begin with <code>##</code> and any subheadings have an additional <code>#</code>.</p>
<figure class="center">
    <img src="proper-toc-headings.png" class="screenshotimg"
         alt="Screenshot showing table of contents fixed with correct heading indentation"/> <figcaption>
            <p>Much better!</p>
        </figcaption>
</figure>

<h4 id="fix-emojis">Fix Emojis</h4>
<p>Who doesn&rsquo;t love the use of emojis ‚ÅâÔ∏è Well I don&rsquo;t when they render badly. Before this exercise I was using a custom shortcode to render them.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"># layouts/shortcodes/emoji.html
{{ .Get 0 | emojify }}
</code></pre></div><blockquote>
<p><a href="https://gohugo.io/content-management/shortcodes/">Shortcodes</a> are similar to partial templates in that they contain HTML, but they are usually for referring to one HTML element as opposed to multiple.</p>
</blockquote>
<p>Then in my markdown I would refer back to them such as <code>{{&lt; emoji &quot;:wave:&quot; &gt;}}</code>. However in headings they rendered as below&hellip;</p>
<figure class="center">
    <img src="bad-emojis-headings.png" class="screenshotimg"
         alt="Screenshot showing poorly rendered emojis in Table of Contents"/> <figcaption>
            <p>Hugo clearly finds this hysterical</p>
        </figcaption>
</figure>

<p>It&rsquo;s a weird one for sure - especially since they render fine in the headings themselves already&hellip;</p>
<figure class="center">
    <img src="good-emoji-heading-1.png" class="screenshotimg"
         alt="Screenshot with heading example with emoji 1"/> 
</figure>

<figure class="center">
    <img src="good-emoji-heading-2.png" class="screenshotimg"
         alt="Screenshot with heading example with emoji 2"/> 
</figure>

<p>There is a fix for these, and it&rsquo;s called <em>rendering emojis the correct way!</em> üòÖ</p>
<p>Firstly in the site <code>config.toml</code> I added <code>enableEmoji = true</code> at the root level and then proceeded to change all occurrence of <code>{{&lt; emoji &quot;:emoji_name:&quot; &gt;}}</code> to <code>:emoji_name:</code>. With that I can then remove <code>layouts/shortcodes/emoji.html</code> since it&rsquo;s not being referred back to anymore.</p>
<figure class="center">
    <img src="correct-emoji-headings.png" class="screenshotimg"
         alt="Screenshot with correct emoji rendering in table of contents"/> <figcaption>
            <p>Nicely done</p>
        </figcaption>
</figure>

<h4 id="markdown-not-rendering">Markdown Not Rendering</h4>
<p>I also noticed that markdown wasn&rsquo;t rendering properly too. Given the markdown <code>## Spice Up Your ~~Life~~ Python üêç</code>, which renders as a heading in the screenshot below&hellip;</p>
<figure class="center">
    <img src="markdown-heading-render.png" class="screenshotimg"
         alt="Screenshot showing a heading formatted correctly with markdown"/> 
</figure>

<p>But in the table of contents it appears without the tilde strikethrough (<code>~</code>) rendering.</p>
<figure class="center">
    <img src="incorrect-markdown-rendering-toc.png" class="screenshotimg"
         alt="Screenshot showing tilde strikethrough not appearing in table of content entry"/> 
</figure>

<p>This looks to be a bug within Hugo itself, since I was able to get <strong>strong</strong> and <em>emphasise</em> to render fine - I <a href="https://github.com/gohugoio/hugo/issues/7169">raised an issue</a> on the project - I can live with it for now.</p>
<h2 id="emojify-everything">Emojify Everything!</h2>
<p>Continuing on the theme of emojis; we were able to get them to appear in the Table of Contents fine. But what about in the titles of the articles themselves? We can add them in the <code>title</code> front matter setting like below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">---
<span style="color:#ff79c6">date</span>: 2019-07-05
<span style="display:block;width:100%;background-color:#3d3f4a"><span style="color:#ff79c6">title</span>: <span style="color:#f1fa8c">&#34;:‚Äã‚Äã‚Äãsnake: Three Ways To Spice Up Your Python Code&#34;</span>
</span><span style="color:#6272a4"># ...</span>
---

</code></pre></div><p>Having a look around the site we see these aren&rsquo;t getting rendered correctly in a number of places&hellip;</p>
<p><strong>(1)</strong> Post title</p>
<figure class="center">
    <img src="broken-emoji-post-title.png" class="screenshotimg"
         alt="Screenshot of broken emoji on post title"/> 
</figure>

<p><strong>(2)</strong> Browser title</p>
<figure class="center"><a href="broken-emoji-browser-title.png">
    <img src="broken-emoji-browser-title.png"
         alt="Screenshot of broken emoji on browser title"/> </a>
</figure>

<p><strong>(3)</strong> Type list entry</p>
<figure class="center">
    <img src="broken-emoji-list.png" class="screenshotimg"
         alt="Screenshot of broken emoji rendering on lists"/> 
</figure>

<p>This is all to do with how the theme is rendering these, they are not &ldquo;<a href="https://gohugo.io/functions/emojify/">emojifying</a>&rdquo; the text it is receiving. This is easy to fix but it involves us copying over the respective files where they are being rendered from in hugo-coder and overwriting thme in our project root (back to <a href="#template-lookup-order-primer">template ordering</a> again!).</p>
<h3 id="fix-post--browser-title">Fix Post &amp; Browser Title</h3>
<p>We can kill two birds with one stone since these are both found in the same file, the <code>layouts/posts/single.html</code> file - this is the main file used to render the article page. If you followed <a href="#implementation">above</a>, you&rsquo;ll notice we already copied across that file to our project root in order to add a TOC.</p>
<p>We need to go back to that file and <em>emojify</em> both the main article heading, alongside the browser title to change any occurrence of <code>{{ .Title }}</code> to <code>{{ .Title | emojify }}</code>.</p>
<p>By doing this we will <em>always</em> emojify the titles even if in our <code>config.toml</code> we specified <code>enableEmoji = false</code>, or didn&rsquo;t specify it at all. This will conflict with the default state of the setting which is <code>false</code>. We could do some conditional logic on the <code>enableEmoji</code> setting, but unfortunately this isn&rsquo;t exposed to us to be able to perform something like <code>{{ if .Site.enableEmoji }}</code>. Because of this we cannot create a pull request (PR) to merge it in with the <code>hugo-coder</code> theme. I&rsquo;ve raised a <a href="https://github.com/gohugoio/hugo/issues/7171">couple</a> of <a href="https://github.com/gohugoio/hugo/issues/7170">issues</a> against Hugo requesting these features.</p>
<p>Since this is just for my website I am okay with the overriding behaviour of emojiying the title.</p>
<p>See the Gist below for my completed <code>single.html</code> file, including the TOC addition earlier.</p>
<script type="application/javascript" src="https://gist.github.com/jdheyburn/35a10e346848379ec5f6f87cb48454cd/3a30b153aae5a761f62293add95187e280d8c3d3.js"></script>

<p>You&rsquo;ll notice I&rsquo;m emojifying (surely I&rsquo;ve said this enough times to make it into the Oxford Dictionary?!) the site title too. This is incase myself (or even yourselves) wish to add emojis there too.</p>
<p>The end result for the title will look like this:</p>
<figure class="center">
    <img src="fixed-emoji-post-title.png" class="screenshotimg"
         alt="Screenshot of fixed emoji on post title"/> 
</figure>

<p>And the browser title is fixed accordingly:</p>
<figure class="center"><a href="fixed-emoji-browser-title.png">
    <img src="fixed-emoji-browser-title.png"
         alt="Screenshot of fixed emoji on browser title"/> </a>
</figure>

<h3 id="fix-type-list-entry">Fix Type List Entry</h3>
<p>We need to find the file in the theme that determines how to render a list entry for a page of type <code>posts</code> and make the modification there - <code>layouts/posts/li.html</code>. We&rsquo;ll need to do the same here as we did for <code>single.html</code> and copy it to our project root.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cp -v themes/hugo-coder/layouts/posts/li.html layouts/posts
</code></pre></div><p>Likewise for the title in the previous section, we need to emojify the title of the article as it&rsquo;s being listed out.</p>
<script type="application/javascript" src="https://gist.github.com/jdheyburn/177fb9f74a38306d9257fb7302ba221c.js"></script>

<p>Once done, we can see it reflect nicely in the list:</p>
<figure class="center">
    <img src="fixed-emoji-list.png" class="screenshotimg"
         alt="Screenshot of fixed emoji rendering on lists"/> 
</figure>

<h2 id="conclusion">Conclusion</h2>
<p>There was a lot covered in this post, to recap we&hellip;</p>
<ol>
<li>Upgraded the Hugo version used to render the website locally, as well as in the CI/CD pipeline</li>
<li>Also updated the version of the theme we&rsquo;re using
<ul>
<li>Made use of new features that came with it such as series links</li>
</ul>
</li>
<li>Added a table of contents to our longer articles</li>
<li>Added support for emojis in post titles</li>
</ol>
<p>You can view all the changes made in this post at this <a href="https://github.com/jdheyburn/jdheyburn.co.uk/pull/2">pull request</a>.</p>
<p>Thanks for reading! üåù</p>

      </div>


      <footer>
        

<section class="see-also">
  
    
    
    
      <h3>See also in Who Goes Blogging</h3>
      <nav>
        <ul>
        
        
          
            <li>
              <a href="https://jdheyburn.co.uk/blog/who-goes-blogging-7-hugo-minify-rss-code-indentation-fix/">Who Goes Blogging 7: Hugo Minify RSS Code Indentation Fix</a>
            </li>
          
        
          
            <li>
              <a href="https://jdheyburn.co.uk/blog/who-goes-blogging-6-three-steps-to-improve-hugos-rss-feeds/">Who Goes Blogging 6: Three Steps to Improve Hugo&#39;s RSS Feeds</a>
            </li>
          
        
          
        
          
            <li>
              <a href="https://jdheyburn.co.uk/blog/who-goes-blogging-4-content-structure-and-refactoring/">Who Goes Blogging 4: Content Structure &amp; Refactoring</a>
            </li>
          
        
          
            <li>
              <a href="https://jdheyburn.co.uk/blog/who-goes-blogging-3-2-deployment-methods-github-actions/">Who Goes Blogging 3.2: Deployment Methods - GitHub Actions</a>
            </li>
          
        
          
            <li>
              <a href="https://jdheyburn.co.uk/blog/who-goes-blogging-3-1-deployment-methods-travisci/">Who Goes Blogging 3.1: Deployment Methods - TravisCI</a>
            </li>
          
        
        </ul>
      </nav>
    
  
</section>


        
        
        
      </footer>
    </article>

    
  </section>

      </div>

      
  <footer class="footer">
    <section class="container">
      
      
        ¬©
        
        2020
         Joseph D. Heyburn 
      
      
         ¬∑ 
        Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
      
      
    </section>
  </footer>

    </main>

    

    

  </body>

</html>
