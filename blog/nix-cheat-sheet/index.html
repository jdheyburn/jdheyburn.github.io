<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><script defer data-domain=jdheyburn.co.uk data-api=/other/apples/event src=https://jdheyburn.co.uk/other/apples/script.js></script><meta name=author content="Joseph D. Heyburn"><meta name=description content="Ramblings of a tech guy"><meta name=keywords content="blog,developer,devops,cloud"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jdheyburn.co.uk/blog/nix-cheat-sheet/cover.png"><meta name=twitter:title content="Nix Cheat Sheet"><meta name=twitter:description content="One stop shop with some low-level snippets related to Nix."><meta property="og:title" content="Nix Cheat Sheet"><meta property="og:description" content="One stop shop with some low-level snippets related to Nix."><meta property="og:type" content="article"><meta property="og:url" content="https://jdheyburn.co.uk/blog/nix-cheat-sheet/"><meta property="og:image" content="https://jdheyburn.co.uk/blog/nix-cheat-sheet/cover.png"><meta property="article:published_time" content="2023-01-13T00:00:00+00:00"><meta property="article:modified_time" content="2023-01-26T00:00:00+00:00"><base href=https://jdheyburn.co.uk/blog/nix-cheat-sheet/><title>Nix Cheat Sheet · JDHeyburn
</title><link rel=canonical href=https://jdheyburn.co.uk/blog/nix-cheat-sheet/><link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel=stylesheet><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.13.0/css/all.css integrity=sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=https://jdheyburn.co.uk/css/coder.min.f01c647a0d25b40da992a37c3376291185eed8a50ced8c26cc2c0bcfe38c97df.css integrity="sha256-8Bxkeg0ltA2pkqN8M3YpEYXu2KUM7YwmzCwLz+OMl98=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://jdheyburn.co.uk/css/coder-dark.min.126ad3988d46bdae6217a11105b53c9662bca05f39d42d3c0fb366919d334620.css integrity="sha256-EmrTmI1Gva5iF6ERBbU8lmK8oF851C08D7NmkZ0zRiA=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://jdheyburn.co.uk/css/custom.css><link rel=icon type=image/png href=https://jdheyburn.co.uk/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://jdheyburn.co.uk/images/favicon-16x16.png sizes=16x16><meta name=generator content="Hugo 0.124.1"></head><body class=colorscheme-dark><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://jdheyburn.co.uk/>JDHeyburn
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://jdheyburn.co.uk/about/>About</a></li><li class=navigation-item><a class=navigation-link href=https://jdheyburn.co.uk/blog/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://jdheyburn.co.uk/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=https://jdheyburn.co.uk/contact/>Contact</a></li></ul></section></nav><div class=content><section class="container post"><article><div><img class=featimage src=https://jdheyburn.co.uk/blog/nix-cheat-sheet/cover.png alt="Featured image"></div><header><div class=post-title><h1 class=title>Nix Cheat Sheet</h1></div><div class=post-description><p>One stop shop with some low-level snippets related to Nix.</p></div><div class=post-meta><div class=date><span class=posted-on><i class="fas fa-calendar"></i>
<time datetime=2023-01-13T00:00:00Z>13 January 2023
</time></span><span class=posted-on><i class="fas fa-calendar-plus"></i>
<time datetime=2023-01-26T00:00:00Z>26 January 2023
</time></span><span class=reading-time><i class="fas fa-clock"></i>
4-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<a href=https://jdheyburn.co.uk/tags/code-snippets/>code snippets</a>
<span class=separator>•</span>
<a href=https://jdheyburn.co.uk/tags/nix/>nix</a></div></div></header><div><aside><nav id=TableOfContents><ul><li><a href=#documentation>Documentation</a></li><li><a href=#resources>Resources</a></li><li><a href=#functions-and-lambdas>Functions (and Lambdas)</a></li><li><a href=#check-if-attribute-is-in-attrset-shorthand>Check if attribute is in attrset shorthand</a></li><li><a href=#merge-two-attrsets-shorthand>Merge two attrsets shorthand</a></li><li><a href=#add-an-attribute-to-an-attrset>Add an attribute to an attrset</a></li><li><a href=#converting-a-list-to-an-attribute-set>Converting a list to an attribute set</a></li></ul></nav></aside><p>The world of Nix has a bit of a steep learning curve. As I write blog posts on the subject, I&rsquo;ll refer to some of the tips and tricks from the cheat sheet here.</p><h2 id=documentation>Documentation</h2><p>A list of Nix documentation I refer to, along with some getting started pages:</p><ul><li><a href=https://nixos.org/manual/nixpkgs/stable/>Nixpkgs manual</a></li><li><a href=https://nixos.org/manual/nixos/stable/>NixOS manual</a></li><li><a href=https://nix.dev/>nix.dev</a></li><li><a href=https://nixos.org/guides/nix-pills/>Nix Pills</a></li><li><a href=https://zero-to-nix.com/>Zero to Nix</a></li></ul><h2 id=resources>Resources</h2><p>Here are a list of resources I use to search for Nix options, services, and any Nix built-in functions.</p><ul><li><a href="https://search.nixos.org/packages?channel=unstable&from=0&size=50&sort=relevance">NixOS Search</a></li><li><a href=https://mynixos.com/>MyNixOS</a></li><li><a href=https://noogle.dev/>noogle</a></li></ul><h2 id=functions-and-lambdas>Functions (and Lambdas)</h2><p>In some languages you typically have a formal declaration of a function (or lambda), such as for Python:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>double_num</span>(num_to_double)
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> num_to_double <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>2</span>
</span></span></code></pre></div><p>Nixlang is a functional language, and a typical behaviour of these is to define lambdas and assign them to variables.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>double_num = num_to_double: num_to_double <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>2</span>
</span></span></code></pre></div><p>The lambda is defined when we create parameters for that lambda, which are defined by having a variable name prefixed by a colon. From the example above, the parameter for the <code>double_num</code> lambda is <code>num_to_double</code>.</p><p>Once all the parameters are defined we move onto the body, in which the final statement is returned, similarly to the <a href=https://franzejr.github.io/best-ruby/idiomatic_ruby/implicit_return.html>implicit return in Ruby</a>. Here we&rsquo;re just using the maths expression <code>num_to_double * 2</code> to have the intended outcome.</p><h2 id=check-if-attribute-is-in-attrset-shorthand>Check if attribute is in attrset shorthand</h2><p>You can use the built in function <a href=https://nixos.org/manual/nix/stable/language/builtins.html#builtins-hasAttr>hasAttr</a> to determine if an attribute exists within an attrset.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>$ attrSet = { key1 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;key1&#34;</span>; };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ <span style=color:#8be9fd;font-style:italic>builtins</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd;font-style:italic>hasAttr</span> <span style=color:#f1fa8c>&#34;key1&#34;</span> attrSet
</span></span><span style=display:flex><span>true
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ <span style=color:#8be9fd;font-style:italic>builtins</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd;font-style:italic>hasAttr</span> <span style=color:#f1fa8c>&#34;key2&#34;</span> attrSet
</span></span><span style=display:flex><span>false
</span></span></code></pre></div><p>You can use the <code>?</code> operator as an alternate way of doing the same.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>$ attrSet <span style=color:#ff79c6>?</span> <span style=color:#f1fa8c>&#34;key1&#34;</span>
</span></span><span style=display:flex><span>true
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ attrSet <span style=color:#ff79c6>?</span> <span style=color:#f1fa8c>&#34;key2&#34;</span>
</span></span><span style=display:flex><span>false
</span></span></code></pre></div><h2 id=merge-two-attrsets-shorthand>Merge two attrsets shorthand</h2><p>You can use the <code>//</code> operator to merge the contents of the attrset on the right into the attrset on the left.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>$ newAttrset = { key1 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;key1&#34;</span>; } <span style=color:#ff79c6>//</span> { key2 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;key2&#34;</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ newAttrset
</span></span><span style=display:flex><span>{ key1 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;key1&#34;</span>; key2 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;key2&#34;</span>; }
</span></span></code></pre></div><p>If the attribute already exists in the left attrset, then it is overwritten.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>$ attrSet = { key1 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;key1&#34;</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ newAttrSet = attrSet <span style=color:#ff79c6>//</span> { key1 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;newKey1&#34;</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ newAttrSet
</span></span><span style=display:flex><span>{ key1 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;newKey1&#34;</span>; }
</span></span></code></pre></div><h2 id=add-an-attribute-to-an-attrset>Add an attribute to an attrset</h2><p>Given an attrset with this structure:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>$ items = {
</span></span><span style=display:flex><span>  keyName <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>    value1 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;value&#34;</span>;
</span></span><span style=display:flex><span>    value2 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;value&#34;</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We can use the <code>map</code> function to loop over each attrName (attribute name (aka key)) and its value in <code>items</code> to create a new attrset with its attrName added to it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>$ newItems = <span style=color:#8be9fd;font-style:italic>map</span>
</span></span><span style=display:flex><span>    (key: items<span style=color:#ff79c6>.</span><span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>${</span>key<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>//</span> { name <span style=color:#ff79c6>=</span> key; })
</span></span><span style=display:flex><span>    (<span style=color:#8be9fd;font-style:italic>builtins</span><span style=color:#ff79c6>.</span>attrNames items);
</span></span></code></pre></div><p>The <code>map</code> function takes two parameters:</p><ul><li>a lambda that should be performed against each element<ul><li><code>(key: items."${key}" // { name = key; })</code><ul><li>This lambda takes a parameter <code>key</code>, and returns the attribute value at <code>items.key</code>, and merges it with the attrset <code>{ name = key; }</code> using the [[#Merge two attrsets shorthand]].</li></ul></li></ul></li><li>a list of elements<ul><li><code>(builtins.attrNames items)</code></li><li><code>builtins.attrNames</code> is a function that takes a attrset and returns all the attribute names (keys) for it</li></ul></li></ul><p>So <code>newItems</code> will equal the below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>$ newItems
</span></span><span style=display:flex><span>[
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    name <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;keyName&#34;</span>;
</span></span><span style=display:flex><span>    value1 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;value&#34;</span>;
</span></span><span style=display:flex><span>    value2 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;value&#34;</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>];
</span></span></code></pre></div><p>The <code>map</code> function is also useful for converting an attrset to a list, since a list is what is returns by default.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>$ items_list = <span style=color:#8be9fd;font-style:italic>map</span>
</span></span><span style=display:flex><span>    (key: items<span style=color:#ff79c6>.</span><span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>${</span>key<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span>)
</span></span><span style=display:flex><span>    (<span style=color:#8be9fd;font-style:italic>builtins</span><span style=color:#ff79c6>.</span>attrNames items);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ items_list
</span></span><span style=display:flex><span>[
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    value1 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;value&#34;</span>;
</span></span><span style=display:flex><span>    value2 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;value&#34;</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><h2 id=converting-a-list-to-an-attribute-set>Converting a list to an attribute set</h2><p>When we [[#Add an attribute to an attrset|add an attribute to an attset]], the <code>map</code> function returns a list, when we may want to have an attrset back instead.</p><p>We can use the <code>builtins.listToAttrs</code> function to convert it to one. It takes one argument, a list of attrsets that contain two attributes; <code>name</code> and <code>value</code> - the former becomes the attrName and the latter its value.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>$ list = [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        name <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;keyName&#34;</span>;
</span></span><span style=display:flex><span>        value <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>            value1 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;value&#34;</span>;
</span></span><span style=display:flex><span>            value2 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;value&#34;</span>;
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        name <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;keyName2&#34;</span>;
</span></span><span style=display:flex><span>        value <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>            value3 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;value&#34;</span>;
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ attrSet = <span style=color:#8be9fd;font-style:italic>builtins</span><span style=color:#ff79c6>.</span>listToAttrs list
</span></span></code></pre></div><p><code>attrSet</code> will then equal the below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>attrSet = {
</span></span><span style=display:flex><span>    keyName <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>        value1 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;value&#34;</span>;
</span></span><span style=display:flex><span>        value2 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;value&#34;</span>;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>    keyName2 <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>        value3 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;value&#34;</span>;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2024
Joseph D. Heyburn
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main></body></html>